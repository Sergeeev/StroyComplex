DROP DATABASE СтройКомплекс;
CREATE DATABASE СтройКомплекс;
USE СтройКомплекс;


CREATE TABLE Проекты (
    ПроектID INT PRIMARY KEY AUTO_INCREMENT,
    НазваниеПроекта VARCHAR(255),
    ДатаНачала DATE,
    ДатаОкончания DATE,
    Статус VARCHAR(50)
);

CREATE TABLE Сотрудники (
    СотрудникID INT PRIMARY KEY AUTO_INCREMENT,
    Имя VARCHAR(100),
    Фамилия VARCHAR(100),
    Должность VARCHAR(100)
);

CREATE TABLE Материалы (
    МатериалID INT PRIMARY KEY AUTO_INCREMENT,
    НазваниеМатериала VARCHAR(255),
    Категория VARCHAR(100),
    ЦенаЗаЕдиницу INT
);

CREATE TABLE Задачи (
    ЗадачаID INT PRIMARY KEY AUTO_INCREMENT,
    ПроектID INT,
    НазваниеЗадачи VARCHAR(255),
    Статус VARCHAR(50),
    Назначена INT,
    FOREIGN KEY (ПроектID) REFERENCES Проекты(ПроектID),
    FOREIGN KEY (Назначена) REFERENCES Сотрудники(СотрудникID)
);


INSERT INTO Проекты (НазваниеПроекта, ДатаНачала, ДатаОкончания, Статус) VALUES 
('ЖК "Солнечный"', '2024-01-15', '2025-12-20', 'активный'),
('Офисный центр "Бизнес-Плаза"', '2024-03-01', '2024-11-30', 'планирование');

INSERT INTO Сотрудники (Имя, Фамилия, Должность) VALUES       
('Иван', 'Петров', 'Прораб'),
('Мария', 'Сидорова', 'Инженер'),
('Алексей', 'Козлов', 'Менеджер');

INSERT INTO Материалы (НазваниеМатериала, Категория, ЦенаЗаЕдиницу) VALUES 
('Цемент', 'Строительные смеси', 15),
('Кирпич красный', 'Кирпич', 25),
('Арматура', 'Металлические материалы', 85);

INSERT INTO Задачи (ПроектID, НазваниеЗадачи, Статус, Назначена) VALUES 
(1, 'Земляные работы', 'в работе', 1),
(1, 'Фундаментные работы', 'не начата', 1),
(2, 'Проектная документация', 'в работе', 2);

/*Показать проекты с их задачами и сотрудниками что их делают*/
SELECT Проекты.НазваниеПроекта, Задачи.НазваниеЗадачи, Сотрудники.Имя, Сотрудники.Фамилия
FROM Задачи
JOIN Проекты ON Задачи.ПроектID = Проекты.ПроектID
JOIN Сотрудники ON Задачи.Назначена = Сотрудники.СотрудникID;

/*Показать задачи у конкретного проекта*/
SELECT Задачи.НазваниеЗадачи, Задачи.Статус, Сотрудники.Имя, Сотрудники.Фамилия
FROM Задачи 
JOIN Сотрудники ON Задачи.Назначена = Сотрудники.СотрудникID
WHERE Задачи.ПроектID = 1;

/*Подсчитать количество задач у каждого сотрудника*/
SELECT Сотрудники.Имя, Сотрудники.Фамилия, COUNT(Задачи.ЗадачаID) AS  КоличествоЗадач
FROM Сотрудники 
LEFT JOIN Задачи ON Сотрудники.СотрудникID = Задачи.Назначена
GROUP BY Сотрудники.СотрудникID;

/*Показать материалы которые стоят больше 50 рублей*/
SELECT * FROM Материалы WHERE ЦенаЗаЕдиницу > 50;

/*Найти задачи со статусом "в работе"*/
SELECT Задачи.НазваниеЗадачи, Проекты.НазваниеПроекта
FROM Задачи 
JOIN Проекты ON Задачи.ПроектID = Проекты.ПроектID
WHERE Задачи.Статус = 'в работе';

/*Показать проекты и какие у них задачи*/
SELECT Проекты.НазваниеПроекта, Задачи.НазваниеЗадачи
FROM Проекты 
LEFT JOIN Задачи ON Проекты.ПроектID = Задачи.ПроектID;

/*Нахождение сотрудника без задач*/
SELECT Сотрудники.Имя, Сотрудники.Фамилия
FROM Сотрудники 
LEFT JOIN Задачи ON Сотрудники.СотрудникID = Задачи.Назначена
WHERE Задачи.ЗадачаID IS NULL;